<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>XR Tower Defense</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

    <script src="js/main.js"></script>
    <script src="js/tower.js"></script>
    <script src="js/spawner.js"></script>

    <style>
        /* Style du bouton XR */
        #xr-button {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 30px;
            font-size: 20px;
            font-weight: bold;
            color: white;
            background-color: #0055FF;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            z-index: 9999;
            display: none; /* Caché par défaut, on l'affiche si XR est dispo */
        }
        #xr-button:active {
            background-color: #0033CC;
        }
    </style>
</head>
<body>
<button id="xr-button">START XR MODE</button>

<a-scene
        game-manager
        enemy-spawner
        vr-mode-ui="enabled: false"
        webxr="optionalFeatures: hit-test, local-floor, dom-overlay; overlayElement: #overlay"
        renderer="colorManagement: true; alpha: true"
        background="color: transparent">

    <a-camera position="0 1.6 0"></a-camera>

    <a-entity light="type: ambient; intensity: 1"></a-entity>
    <a-entity light="type: directional; intensity: 0.8" position="-1 2 2"></a-entity>

    <a-plane id="floor"
             tower-maker
             rotation="-90 0 0"
             width="40" height="40"
             material="shader: flat; color: #ffffff; opacity: 0.0; transparent: true"
             class="clickable">
    </a-plane>

    <a-entity oculus-touch-controls="hand: left"></a-entity>
    <a-entity laser-controls="hand: right"
              raycaster="objects: .clickable; far: 10"
              line="color: red; opacity: 0.75">
    </a-entity>

</a-scene>

<script>
    const scene = document.querySelector('a-scene');
    const xrButton = document.getElementById('xr-button');

    // On vérifie si le navigateur supporte le XR
    if (navigator.xr) {
        navigator.xr.isSessionSupported('immersive-ar').then((supported) => {
            if (supported) {
                xrButton.style.display = 'block';
                xrButton.textContent = "ENTER AR (Passthrough)";
            } else {
                // Fallback : Si AR pas supporté, on propose VR
                xrButton.style.display = 'block';
                xrButton.textContent = "ENTER VR";
                xrButton.style.backgroundColor = "#555";
            }
        });
    }

    // Action au clic
    xrButton.addEventListener('click', () => {
        // Force l'entrée en mode AR (Réalité Augmentée/Mixte)
        // C'est ça qui active le Passthrough à coup sûr
        scene.enterAR();
        xrButton.style.display = 'none'; // On cache le bouton
    });
</script>
</body>
</html>